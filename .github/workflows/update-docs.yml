name: Update Translated Docs
on:
  workflow_dispatch: {}
permissions:
  contents: write
  pull-requests: write
jobs:
  update-docs:
    if: '!contains(github.event.head_commit.message, ''Update all translated document
      pages'')'
    name: Build and Push Translated Docs
    runs-on: ubuntu-latest
    timeout-minutes: 30
    env:
      PROD_OPENAI_API_KEY: ${{ secrets.PROD_OPENAI_API_KEY }}
    steps:
    - name: Checkout repository
      uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
      with:
        fetch-depth: 0
    - name: Setup uv
      uses: astral-sh/setup-uv@d4b2f3b6ecc6e67c4457f6d3e41ec42d3d0fcb86
      with:
        enable-cache: true
    - name: Install dependencies
      run: make sync
    - name: Build translated docs
      run: 'mode="${{ inputs.translate_mode || ''only-changes'' }}"

        uv run docs/scripts/translate_docs.py --mode "$mode"

        uv run mkdocs build

        '
    - name: Commit changes
      id: commit
      run: "git config user.name \"github-actions[bot]\"\ngit config user.email \"\
        github-actions[bot]@users.noreply.github.com\"\ngit add docs/\nif git diff\
        \ --cached --quiet; then\n  echo \"No changes to commit\"\n  echo \"committed=false\"\
        \ >> \"$GITHUB_OUTPUT\"\nelse\n  git commit -m \"Update all translated document\
        \ pages\"\n  echo \"committed=true\" >> \"$GITHUB_OUTPUT\"\nfi\n"
    - name: Create Pull Request
      if: steps.commit.outputs.committed == 'true'
      uses: peter-evans/create-pull-request@c0f553fe549906ede9cf27b5156039d195d2ece0
      with:
        commit-message: Update translated document pages
        title: 'docs: update translated document pages'
        body: 'Automated update of translated documentation.


          Triggered by commit: [${{ github.event.head_commit.id }}](${{ github.server_url
          }}/${{ github.repository }}/commit/${{ github.event.head_commit.id }}).

          Message: `${{ github.event.head_commit.message }}`

          '
        branch: update-translated-docs-${{ github.run_id }}
        delete-branch: true
