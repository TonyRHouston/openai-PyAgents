name: Update Translated Docs
on:
  workflow_dispatch: {}
jobs:
  update-docs:
    if: '!contains(github.event.head_commit.message, ''Update all translated document
      pages'')'
    name: Build and Push Translated Docs
    runs-on: ubuntu-latest
    timeout-minutes: 20
    env:
      PROD_OPENAI_API_KEY: ${{ secrets.PROD_OPENAI_API_KEY }}
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Setup uv
      uses: astral-sh/setup-uv@v5
      with:
        enable-cache: true
    - name: Install dependencies
      run: make sync
    - name: Build full docs
      run: make build-full-docs
    - name: Commit changes
      id: commit
      run: "git config user.name \"github-actions[bot]\"\ngit config user.email \"\
        github-actions[bot]@users.noreply.github.com\"\ngit add docs/\nif [ -n \"\
        $(git status --porcelain)\" ]; then\n  git commit -m \"Update all translated\
        \ document pages\"\n  echo \"committed=true\" >> \"$GITHUB_OUTPUT\"\nelse\n\
        \  echo \"No changes to commit\"\n  echo \"committed=false\" >> \"$GITHUB_OUTPUT\"\
        \nfi\n"
    - name: Create Pull Request
      if: steps.commit.outputs.committed == 'true'
      uses: peter-evans/create-pull-request@v6
      with:
        commit-message: Update all translated document pages
        title: Update all translated document pages
        body: Automated update of translated documentation
        branch: update-translated-docs-${{ github.run_id }}
        delete-branch: true
